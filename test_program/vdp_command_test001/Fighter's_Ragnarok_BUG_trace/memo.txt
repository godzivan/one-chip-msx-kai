Fighter's Ragnarok の VDPコマンド実行は下記のようになっている。

	(1)VDPコマンドの完了待ち
		R#15 ← 2
		DI
		check S#2
		EI
		R#15 ← 0

	(2)VDPコマンド実行
		OTIR でまとめて転送

	(3)バグ
		XOR A
		OUT (C),A
		LD  A, 08Fh
		OUT (C),A
		EI

		おそらく、R#15 ← 0 を実行しているつもりだと思うが、
		C は VDP PORT#3 を指しているので、
		VDP は下記のように認識する。

		R#47 ← 0
		R#48 ← 08Fh

		これらは存在しないレジスタであるため、MSX実機では問題とならない。
		しかし、1chipMSX の VDP clone は、R#17 の内部レジスタのアドレスオートインクリメントを
		無条件に実行する。

		47 → 101111
		48 → 110000

		そして、下位4bit を使って内部メモリ (VDPコマンドのレジスタを保存している) へ書き込む。

		R#47 への書き込みは問題を起こさないが、R#48 への書き込みは R#32 を破壊する。
		そして、直前に実行開始した VDPコマンドの挙動を壊してしまう。

		実機ではそのようなことが起こらないので、アドレスは 47 で停止するように修正して対処。

2021年5月30日  t.hara (HRA!)
